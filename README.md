血管影像標註與報告系統 (Vessel Annotation & Reporting System)
這是一個使用 Python Tkinter 開發的圖形化介面 (GUI) 工具，專為醫學血管影像（特別是冠狀動脈示意圖）的標註所設計。

本工具旨在簡化標註流程，並自動化報告生成。使用者可以透過直覺的操作，在圖片上標記病灶位置、註記類型（如支架 Stent 或氣球擴張術 Balloon），並能自動辨識血管區域名稱。完成後，系統能一鍵匯出所有標註資料的 Excel 總報告以及視覺化的標註後圖片。

主要功能
圖形化標註介面：提供一個包含圖片顯示區、功能按鈕與註解列表的整合式操作視窗。

多圖瀏覽：可載入多張圖片，並透過「上一張/下一張」按鈕或鍵盤左右鍵輕鬆切換。

智慧標註：

點擊標註：在圖片上點擊即可新增標記點。

自動血管名稱辨識：透過預先建立的「遮罩圖」，程式能自動辨識使用者點擊的血管區域名稱（如 LAD, RCA, LCx）。

分類標註：在彈出的對話框中，可選擇標註類型為 Stent（紅色標記）或 Balloon（黃色標記）。

時間戳記：自動為每一次新增或修改的標註，記錄當下的系統時間。

註解管理：

在右側的註解清單上按右鍵，可彈出選單。

支援修改現有註解的內容與類型。

支援刪除不需要的標註。

一鍵匯出報告：

可輸入檢查序號，作為該次標註的唯一識別碼。

點擊「完成並匯出」後，程式會自動建立以「檢查序號」命名的資料夾。

匯出標註圖片：將所有標記點繪製在原始圖片上，並儲存成新的圖片檔案 (*_annotated.png)。

匯出 Excel 總報告：將所有圖片的所有標註整合成一份 Excel 檔案 ([序號]_report.xlsx)，包含序號、影像檔名、血管名稱、類型、註解、座標、時間等詳細欄位。

遮罩圖製作輔助工具：提供一個獨立的 mask_creator.py 小工具，協助使用者快速、輕鬆地製作血管名稱辨識所需的彩色遮罩圖。

系統需求
Python 3.6 或更高版本

必要的 Python 函式庫：

tkinter (通常內建於 Python)

Pillow (PIL Fork)

pandas

openpyxl (pandas 讀寫 .xlsx 檔案所需)

安裝與設定
確認 Python 環境：
請確保您的電腦已安裝 Python。您可以在終端機或命令提示字元中輸入 python --version 來確認。

下載專案檔案：
將 annotator_final.py (主程式) 和 mask_creator.py (輔助工具) 以及您的圖片檔案 (L_side.jpg, L_side_2.jpg, R_side.png) 放在同一個資料夾中。

安裝函式庫：
打開終端機或命令提示字元，輸入以下指令來安裝所有必要的函式庫：

Bash

pip install Pillow pandas openpyxl
使用流程
本工具的使用流程分為兩個主要階段：【事前準備】 和 【執行標註】。

階段一：【事前準備】建立血管遮罩圖
為了讓程式能自動辨識血管名稱，您需要為每張原始圖片製作一張對應的「遮罩圖」。這個步驟只需要為每張圖做一次即可。

執行輔助工具：
在終端機中執行 python mask_creator.py。

載入原始圖片：
點擊「載入圖片」按鈕，選擇一張您要處理的血管圖（例如 L_side.jpg）。

定義血管與顏色：

點擊「設定血管顏色」，在彈出的對話框中輸入血管名稱（例如 LAD）。

在接下來的顏色選擇器中，為 LAD 挑選一個獨一無二的顏色（例如紅色）。

重複此步驟，為該圖片上所有您想辨識的血管（LCx, D1, S1...）都設定一個在此圖內不重複的專屬顏色。

繪製遮罩：

從視窗上方的顏色按鈕中，點擊一個血管名稱（例如 LAD）來選擇它作為當前的「筆刷」。

按住滑鼠左鍵，在畫布上對應的血管區域進行塗抹。您可以使用「筆刷大小」滑桿調整粗細。

將所有血管都用其對應的顏色塗滿。

儲存遮罩圖與對應表：

完成塗色後，點擊「儲存遮罩圖」。程式會在同目錄下儲存一張 [原圖檔名]_mask.png 的檔案。

同時，請查看執行程式的終端機視窗，裡面會印出類似下方的「顏色-名稱對應表」。請將這段字典內容完整複製下來，下一步會用到。

{(255, 0, 0): 'LAD', (0, 255, 0): 'LCx', ...}
重複流程：
為您所有的原始圖片（L_side_2.jpg, R_side.png）重複以上 1-5 步驟，產生它們各自的遮罩圖和顏色對應表。

階段二：【執行標註】使用主程式
設定主程式：

打開主程式檔案 annotator_final.py。

找到 self.VESSEL_MAPS 這個字典變數。

將您在階段一為每張圖片產生的三份獨立的顏色對應表，分別貼到對應的圖片檔名下。完成後看起來會像這樣：

Python

self.VESSEL_MAPS = {
    "L_side.jpg": {
        (255, 0, 0): 'LAD', (0, 255, 0): 'LCx', ...
    },
    "L_side_2.jpg": {
        (255, 0, 0): 'LAD', (0, 255, 0): 'OM1', ...
    },
    "R_side.png": {
        (255, 0, 0): 'RCA', (0, 0, 255): 'PDA', ...
    }
}
執行主程式：
在終端機中執行 python annotator_final.py。

輸入檢查序號：
在視窗左上角的「檢查序號」欄位中，輸入本次標註的唯一識別碼（例如病歷號或日期）。

進行標註：

使用「上一張/下一張」按鈕切換圖片。

在圖片的目標位置點擊滑鼠左鍵。

程式會自動辨識血管名稱，並顯示在彈出對話框的標題上。

在對話框中輸入註解文字，並點擊 Stent 或 Balloon 按鈕完成標註。

標註會即時顯示在右側清單中。

管理註解：

在右側清單的某個項目上按右鍵，可選擇「修改」或「刪除」。

完成與匯出：

所有標註完成後，點擊右上角的「完成並匯出」綠色按鈕。

程式會根據您輸入的序號建立一個資料夾，並將標註後的圖片和總 Excel 報告儲存於其中，然後自動關閉。

檔案結構
.
├── annotator_final.py        # 主應用程式
├── mask_creator.py           # 遮罩圖製作輔助工具
├── README.md                 # 本說明文件
├── L_side.jpg                # 原始圖片 1
├── L_side_mask.png           # (由工具產生) 圖片 1 的遮罩圖
├── L_side_2.jpg              # 原始圖片 2
├── L_side_2_mask.png         # (由工具產生) 圖片 2 的遮罩圖
├── R_side.png                # 原始圖片 3
└── R_side_mask.png           # (由工具產生) 圖片 3 的遮罩圖
